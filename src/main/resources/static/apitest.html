<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
  <h2>API Test 조회</h2>
  <fieldset>
  <label>아이디</label>
  <input type="number" id="id" value="1" /> <br>
  <label>제목</label>
  <input type="text" id="title" /> <br>
  <label>내용</label>
  <textarea id="content" rows="3"></textarea> <br>
  </fieldset>
  <div id="output"></div>
  <ul>
    <li><a id="get"    href="/api/articles">Article 목록 조회(get)</a></li>
    <li><a id="getOne" href="/api/articles">1개의 글 조회(get)</a></li>
    <li><a id="post"   href="/api/articles">새 글 추가(post)</a></li>
    <li><a id="patch"  href="/api/articles">글 수정(patch)</a></li>
    <li><a id="delete" href="/api/articles">글 삭제(delete)</a></li>
  </ul>
  
  <script>
    const outputEl = document.querySelector('#output')
    const aElList = document.querySelectorAll('a')
    aElList.forEach((aEl,i)=>{
      aEl.onclick = (e) => {
    	  e.preventDefault(); // 기존 <a> 의 기능을 무력화시키는 기능
    		// alert(aEl.id);
    	  
    	  let id = null;
    	  let title = null;
    	  let content = null;
    	  let params = null;
    	  
    	  switch(aEl.id){
    	  case "get": 
    	   fetch(aEl.href ) 
    	  //fetch(aEl.href, {method:'GET'} ) - {method:'GET'}은 생략가능(생략하면 get이라 생각하면 됨)
    	  .then( response => response.json() )
    	  .then( json     => {
    		  outputEl.innerHTML = JSON.stringify(json)
    	  } )
    	  .catch( error => console.dir(error) )
    	  break;
    	  
    	  case "getOne":
    	  const numId = document.querySelector('#id').value;
    	  fetch(aEl.href +"/"+ numId )
    	  .then( response => response.json() ) // json = JSON.parse()
    	  .then( json     => {
    		  outputEl.innerHTML = JSON.stringify(json);
    		  document.querySelector('#id').value      = json.id; 
    		  document.querySelector('#title').value   = json.title; 
    		  document.querySelector('#content').value = json.content; 
    	  } )
    	  .catch( error => console.dir(error) )
    	  break;
    	  
    	  case "post":
    	  id      = document.querySelector('#id').value;
    	  title   = document.querySelector('#title').value;
    	  content = document.querySelector('#content').value;
    	  params  = {
    			  method: "POST",
    			  headers : {
    				  "Accept" : "application/json",
    				  "Content-Type" : "application/json",
    				  "Access-Control-Origin" : "*" // CORS 정책을 피한다
    			  },
    			  body: JSON.stringify({
   //넘겨주는 parameter 값 : 변수
                    id     : id,
    			    title  : title,
    			    content: content,
    			  }),	  
    	  }
    	 // fetch(aEl.href, new URLSearchParams(params) )
    	  fetch(aEl.href, params )
    	  .then( response => response.json() )
    	  .then( json     => {
    		  console.dir(json)
    		  outputEl.innerHTML = JSON.stringify(json)
    	  } )
    	  .catch( error => console.dir(error) )
    	  break;
    	  
    	  case "patch":
    	  id      = document.querySelector('#id').value;
    	  title   = document.querySelector('#title').value;
    	  content = document.querySelector('#content').value;
    	  params  = {
    			  method: "PATCH",
    			  headers : {
    				  "Accept" : "application/json",
    				  "Content-Type" : "application/json",
    				  "Access-Control-Origin" : "*" // CORS 정책을 피한다
    			  },
    			  body: JSON.stringify({
   //넘겨주는 parameter 값 : 변수
                    id     : id,
    			    title  : title,
    			    content: content,
    			  }),	  
    	  }
    	 // fetch(aEl.href, new URLSearchParams(params) )
    	  fetch(aEl.href + "/" + id, params )
    	  .then( response => response.json() )
    	  .then( json     => {
    		  console.dir(json)
    		  outputEl.innerHTML = JSON.stringify(json)
    	  } )
    	  .catch( error => console.dir(error) )
    	  break;
    	  
    	  case "delete":
    	  id      = document.querySelector('#id').value;
    	  params  = {
    			  method: "DELETE",
    			  headers : {
    				  "Accept" : "application/json",
    				  "Content-Type" : "application/json",
    				  "Access-Control-Origin" : "*" // CORS 정책을 피한다
    			  },
    			  body: JSON.stringify({
   //넘겨주는 parameter 값 : 변수
                    id     : id,
    			  }),	  
    	  }
    	 // fetch(aEl.href, new URLSearchParams(params) )
    	  fetch(aEl.href , params )
    	  .then( response => response.json() )
    	  .then( json     => {
    		  console.dir(json)
    		  outputEl.innerHTML = JSON.stringify(json)
    	  } )
    	  .catch( error => console.dir(error) )
    	  break;
        }
      }
    })
  
  </script>
</body>
</html>